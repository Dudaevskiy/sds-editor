!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.embedPresetBasic=e()}(this,function(){"use strict";function t(){var e=[].slice.call(arguments),n=!1;"boolean"==typeof e[0]&&(n=e.shift());var r=e[0];if(!r||"object"!=typeof r&&"function"!=typeof r)throw new Error("extendee must be an object");for(var o=e.slice(1),i=o.length,s=0;s<i;s++){var u=o[s];for(var c in u)if(u.hasOwnProperty(c)){var a=u[c];if(n&&function(t){return Array.isArray(t)||"[object Object]"=={}.toString.call(t)}(a)){var p=Array.isArray(a)?[]:{};r[c]=t(!0,r.hasOwnProperty(c)?r[c]:p,a)}else r[c]=a}}return r}function e(t,e){var n=t.map(function(t){return function(t,e){var n=t.concat([t.index,t.input]);return e.apply(null,n).then(function(e){return A({},t,{replacement:e})})}(t,e)});return Promise.all(n)}function n(t,n,r){n.lastIndex=0;try{return Promise.resolve(function(t,n,r){return e(function(t,e){for(var n=[],r=e.exec(t);r&&(n.push(r),e.global);)r=e.exec(t);return n}(t,n),r).then(function(e){return function(t,n){return e.reverse().reduce(function(t,e){var n=t.slice(0,e.index),r=t.slice(e.index+e[0].length);return n+e.replacement+r},t)}(t)})}(t,n,r))}catch(t){return Promise.reject(t)}}function r(t,e,n){return void 0===n&&(n=!1),n?t.test(e):e.match(t)}function o(t,e){var n=t.result,r=t.plugins;void 0===r&&(r=[]);return function(t){return new RegExp("<a[^>]*>("+t.source+")<\\/a>","gi")}(e.regex).test(n)||r.filter(function(t){return"url"===t.id}).length}function i(t,e,n){var r=t._services,o=e.id;r.filter(function(t){return t.match===n}).length||r.push({id:o,match:n})}function s(t,e,r,o){return new Promise(function(s,c){var a,p;return p=r,a=p.regex,n(t,a,function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new Promise(function(n,s){return u(t,e,r).then(function(u){try{return e._embeds.push({content:u,index:o||t.find(function(t){return"number"==typeof t})}),i(e,r,t[0]),n()}catch(t){return s(t)}},s)})}).then(function(t){try{return s(e)}catch(t){return c(t)}},c)})}function u(t,e,n){var r=this;return new Promise(function(o,i){function s(){return o(c(t,e,n,a))}var u,c,a,p;return p=n,u=p._process,c=p.template,u?u(t,e,n).then(function(t){try{return a=t,s.call(r)}catch(t){return i(t)}},i):s.call(r)})}function c(t){var e={id:O,regex:/(`{3})(\s|[a-z]+)\s*([\s\S]*?[^`])\s*\1(?!`)/gm,prismjs:P?window.Prism:global.Prism,template:function(t,e,n){var r=n.prismjs,o="\n"!==t[2]&&t[2]?t[2]:"markup",i=t[3],s="language-"+o;return'<pre class="'+s+'"><code class="'+s+'">'+r.highlight(i,r.languages[o])+"</code></pre>"}},n=A({},e,t,{_replaceAnyways:!0,_ignoreAnchorCheck:!0,_ignoreInlineCheck:!0});if(!n.prismjs)throw new Error("You need to load prismjs as a global variable or pass it in options.");return L(n)}function a(t){var e={id:N,regex:Z(),template:function(t){return'<span class="ec ec-'+I(t)+'"></span>'}},n=A({},e,t);return{transform:function(t){return Promise.resolve(A({},t,{result:t.result.replace(n.regex,function(e,r){return t._services.push({id:N,match:e}),n.template(r,t,n)})}))}}}function p(t,e){var n=e.fetch;return new Promise(function(e,r){var o,i,s,u;o=(u=t)[1],i=u[2];var c=function(t){try{return e({})}catch(t){return r(t)}};try{return n("https://api.github.com/repos/"+o+"/"+i).then(function(t){try{return s=t,e(s.json())}catch(t){return c()}},c)}catch(t){c()}})}function h(t){var e=A({},{id:T,regex:/[^\.]github.com\/([\w\.\-]+)\/([\w\.\-]+[^\.])/gi,template:function(t,e,n,r){var o=r.owner,i=r.description,s=r.html_url,u=r.full_name;return new Promise(function(t,e){return t(C({thumbnail:o.avatar_url,url:s,description:i,title:u}))})}},t,{_process:p});return L(e)}function l(t){if(!Array.isArray(t))throw new Error("expected an array");for(var e=[],n=t.length,r=0;r<n;r++){var o=t[r];Array.isArray(o)?e.push.apply(e,l(o)):e.push(o)}return e}function f(t,e){var n=e.fetch;return new Promise(function(e,r){var o,i;o=t[0];var s=function(t){try{return e({html:o})}catch(t){return r(t)}};try{return n("https://noembed.com/embed?url="+o).then(function(t){try{return(i=t).json().then(e,s)}catch(t){return s()}},s)}catch(t){s()}})}function m(t){void 0===t&&(t={});var e={id:Y,regex:null,exclude:[],twttr:P?window.twttr:null,onLoad:function(){},template:function(t,e,n,r){var o=r.html;return new Promise(function(t,e){return t('<div class="ejs-embed">'+o+"</div>")})},_onLoadInternal:function(t,e){var n=t.input,r=t.result,o=e.twttr,i=e.onLoad;(function(t,e){var n=M.filter(function(e){return e.name.toLowerCase()===t})[0];return new RegExp(n.patterns.join("|"),"gi").test(e)})("twitter",r)&&o&&B(n)&&(o.widgets.load(n),o.events.bind("loaded",i))}},n=A({},e,t,{_process:f});return t.regex||(n.regex=function(t){void 0===t&&(t=[]);var e=M.filter(function(e){return-1===t.indexOf(e.name.toLowerCase())}),n=U(R(e,"patterns"));return new RegExp(n.join("|"),"gi")}(n.exclude)),L(n)}function d(t,e){var n=J(t),r=t;/^[a-zA-Z]{1,6}:/.test(r)||(r="http://"+r);return"<a "+function(){return Array.prototype.slice.call(arguments).map(v).filter(Boolean).join(" ")}({href:r},e)+">"+n+"</a>"}function v(t){return t?Object.keys(t).map(function(e){var n=t[e];return J(e)+'="'+J(n)+'"'}).join(" "):""}function w(t){var e=A({},{attributes:{},escape:!1},t),n=e.attributes,r=e.escape;return{id:tt,transform:function(t){return new Promise(function(e,o){return e(A({},t,{result:X(t.result,{attributes:n,escape:r})}))})}}}function g(t,e,n){var r=e.fetch,o=n.gAuthKey;return n.details?function(t,e,n){return new Promise(function(r,o){var i,s,u=function(t){try{return console.log(t),r({})}catch(t){return o(t)}};try{return e("https://www.googleapis.com/youtube/v3/videos?id="+t+"&key="+n+"&part=snippet,statistics").then(function(t){try{return(i=t).json().then(function(t){try{return s=t,r(s.items[0])}catch(t){return u(t)}},u)}catch(t){return u(t)}},u)}catch(t){u(t)}})}(t[1],r,o):Promise.resolve()}function y(t){var e={id:nt,regex:et(),gAuthKey:"",details:!0,height:300,clickClass:"ejs-video-thumb",onVideoShow:function(){},_onLoadInternal:function(t,e){!function(t,e){var n=t.input,r=e.clickClass,o=e.onVideoShow,i=e.height;if(!B(n))throw new Error("input should be a DOM Element.");for(var s=document.getElementsByClassName(r),u=0;u<s.length;u++)s[u].onclick=function(){var t=this.getAttribute("data-url");o(t),t+="?autoplay=1",this.parentNode.innerHTML=S(t,i,nt)}}(t,e)},onLoad:function(){},template:function(t,e,n,r){var o=n.details,i=n.height,s=n.clickClass;return new Promise(function(e,n){var u=rt+"embed/"+t[1];return e(o?C(function(t){var e=t.snippet,n=t.id;return{title:e.title,thumbnail:e.thumbnails.medium.url,description:e.description,url:rt+"watch?v="+n,embedUrl:rt+"embed/"+n}}(r),s,!0):S(u,i,nt))})}};if(!t.gAuthKey)throw new Error("You need to pass google auth key.");var n=A({},e,t,{_process:g});return L(n)}function b(t){var e=A({},{id:ot,regex:/(https?:\/\/)?www\.facebook\.com\/(?:(videos|posts)\.php\?v=\d+|.*?\/(videos|posts)\/\d+\/?)/gi,height:225,template:function(t,e,n){var r=n.height,o=t[0],i=o.indexOf("/videos/")<0?"post":"video";return S("https://www.facebook.com/plugins/"+i+".php?href="+o,r,ot)}},t);return L(e)}function x(t){var e={id:it,regex:new RegExp("(?:https?)://\\S*\\.(?:"+st.concat(ut,ct).join("|")+")","gi"),template:function(t){var e=t[0],n=e.split(".").slice(-1)[0];return st.indexOf(n)>=0?'<img class="ejs-embed" src="'+e+'"/>':ut.indexOf(n)>=0?'<video src="'+e+'" controls class="ejs-video"></video>':ct.indexOf(n)>=0?'<audio src="'+e+'" controls class="ejs-audio"></audio>':void 0}},n=A({},e,t);return L(n)}function j(t){var e=A({},{id:at,height:440,regex:/((https?:\/\/)(www\.)?instagram.com\/p\/[a-zA-Z0-9_\-\=]+)(\/\?[a-zA-Z0-9_\-\=]+)?/gi,template:function(t,e,n){n.width;var r=n.height;return'<iframe class="ejs-embed ejs-instagram" src="'+t[1]+'/embed" height="'+r+'"></iframe>'}},t);return L(e)}var A=t,_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P="object"===("undefined"==typeof window?"undefined":_(window))&&"object"===("undefined"==typeof document?"undefined":_(document))&&9===document.nodeType,k=/<a[^>]*>([^<]+)<\/a>/gi,E=function(t,e){return new Promise(function(c,a){var p,h,l,f,m;p=t.inlineEmbed;var d;return d=e,h=d._ignoreAnchorCheck,l=d._ignoreInlineCheck,f=d.regex,p||l?new Promise(function(s,c){return o(t,{regex:f})&&!h?function(t,e){return new Promise(function(o,s){var c=t.result,a=t.replaceUrl,p=e.regex,h=e._replaceAnyways;return o(n(c,k,function(o,s){return new Promise(function(c,l){var f,m;return r(p,s,!0)?a||h?c(n(s,p,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,o){return i(t,e,n[0]),r(u(n,t,e))})})):(f=function(t,e){t.lastIndex=0;var n=t.exec(e);return t.lastIndex=0,n}(p,s),i(t,e,f[0]),u(f,t,e).then(function(t){try{return m=t,c(f?o+m:o)}catch(t){return l(t)}},l)):c(o)})}))})}(t,e).then(s,c):function(t,e){return new Promise(function(r,o){var s=t.result,c=t.replaceUrl,a=e.regex,p=e._replaceAnyways;return r(n(s,a,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,o){return i(t,e,n[0]),new Promise(function(r,o){return c||p?r(u(n,t,e)):u(n,t,e).then(function(t){try{return r(n[0]+" "+t)}catch(t){return o(t)}},o)}).then(r,o)})}))})}(t,e).then(s,c)}).then(function(e){try{return m=e,c(A({},t,{result:m}))}catch(t){return a(t)}},a):c(function(t,e){var u=this;return new Promise(function(c,a){function p(){return c(l)}var h,l,f;return f=e,h=f.regex,l=A({},t),o(l,{regex:h})?n(l.result,k,function(t,n,o){return new Promise(function(u,c){return r(h,t,!0)?(i(l,e,t),s(n,l,e,o).then(function(e){try{return l=e,u(t)}catch(t){return c(t)}},c)):u(t)})}).then(function(t){try{return p.call(u)}catch(t){return a(t)}},a):(l=s(l.result,l,e),p.call(u))})}(t,e))})},z=function(t,e,n){return null==e||e>=t.length?t:(null==n&&(n="..."),t.slice(0,Math.max(0,e-n.length))+n)},C=function(t,e,n){var r=t.url,o=t.title,i=t.embedUrl,s=t.description,u=t.thumbnail;return void 0===n&&(n=!1),'<div class="ejs-preview ejs-embed"><div class="ejs-thumb '+e+'" data-url="'+i+'" style="background-image:url('+u+')">'+(n?"<span>&#9658;</span>":"")+'</div><div class="ejs-info"><h4 class="ejs-title"><a href="'+r+'">'+o+'</a></h4><div class="ejs-desc">'+z(s,150)+"</div></div></div>"},S=function(t,e,n){return'<iframe class="ejs-embed ejs-'+n+'" src="'+t+'" frameBorder="0" height="'+e+'"></iframe>'},L=function(t){var e=A({},{_replaceAnyways:!1,_ignoreAnchorCheck:!1,_ignoreInlineCheck:!1,onLoad:function(){}},t),n=e._onLoadInternal,r=e.onLoad,o=e.regex,i=e.template,s=e.id;if(!o)throw new Error("regex not passed.");if(!i)throw new Error("template not passed.");return{id:s,transform:function(t){return new Promise(function(n,r){return E(t,e).then(function(e){try{return n(A({},t,e))}catch(t){return r(t)}},r)})},onLoad:function(t){n&&n(t,e),r&&r(t,e)}}},O="highlight";c.id=O;var Z=function(){return/:([a-z0-9_\+\-]+):/g},I=function(t){return(t=t.replace(K,function(t){return" "+(t.toLowerCase()||t)})).trim().split(D).join("-")},D=/[\s\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]+/,K=/[A-Z\u00C0-\u00D6\u00D9-\u00DD]/g,N="emoji";a.id=N;var T="github";h.id=T;var B=function(t){return!(!t||"object"!=typeof t)&&("object"==typeof window&&"object"==typeof window.Node?t instanceof window.Node:"number"==typeof t.nodeType&&"string"==typeof t.nodeName)},R=function(t,e){if(!t||"object"!=typeof t)return new Error("expected first argument to be an object or array");var n,r,o,i,s;if(Array.isArray(t))for(n=[],r=t.length,o=0;o<r;o++)n.push(t[o][e]);else for(n={},r=(i=Object.keys(t)).length,o=0;o<r;o++)n[s=i[o]]=t[s][e];return n},U=l,M=[{patterns:["https?://soundcloud.com/.*/.[^\\s]*"],name:"SoundCloud"},{name:"slideshare",patterns:["https?://www\\.slideshare\\.net/.*/.[^\\s]*","https?://fr\\.slideshare\\.net/.*/.[^\\s]*","https?://de\\.slideshare\\.net/.*/.[^\\s]*","https?://es\\.slideshare\\.net/.*/.[^\\s]*","https?://pt\\.slideshare\\.net/.*/.[^\\s]*"]},{name:"vimeo",patterns:["https?://vimeo\\.com/.[^\\s]*","https?://vimeo\\.com/album/.*/video/.[^\\s]*","https?://vimeo\\.com/channels/.*/.[^\\s]*","https?://vimeo\\.com/groups/.*/videos/.[^\\s]*","https?://vimeo\\.com/ondemand/.*/.[^\\s]*"]},{patterns:["https?://photos\\.app\\.net/.*/.[^\\s]*","https?://live\\.amcharts\\.com/.[^\\s]*","https?://codepen\\.io/.[^\\s]*","https?://codepen\\.io/.[^\\s]*","https?://www\\.collegehumor\\.com/video/.[^\\s]*","https?://www\\.dailymotion\\.com/video/.[^\\s]*","https?://.*\\.deviantart\\.com/art/.[^\\s]*","https?://.*\\.deviantart\\.com/.*#/d.[^\\s]*","https?://dotsub\\.com/view/.[^\\s]*","https?://.*\\.flickr\\.com/photos/.[^\\s]*","https?://flic\\.kr/p/.[^\\s]*","https?://.*\\.wikimedia\\.org/.*_geograph\\.org\\.uk_.[^\\s]*","https?://gfycat\\.com/.[^\\s]*","https?://www\\.gfycat\\.com/.[^\\s]*","https?://gfycat\\.com/.[^\\s]*","https?://www\\.gfycat\\.com/.[^\\s]*","https?://giphy\\.com/gifs/.[^\\s]*","https?://media\\.giphy\\.com/media/.*/giphy\\.gif","https?://www\\.hulu\\.com/watch/.[^\\s]*","https?://www\\.kickstarter\\.com/projects/.[^\\s]*","https?://www\\.mixcloud\\.com/.*/.*/","https?://reddit\\.com/r/.*/comments/.*/.[^\\s]*","https?://.*\\.screen9\\.tv/.[^\\s]*","https?://www\\.scribd\\.com/doc/.[^\\s]*","https?://.*\\.smugmug\\.com/.[^\\s]*","https?://soundcloud\\.com/.[^\\s]*","https?://play\\.soundsgood\\.co/playlist/.[^\\s]*","https?://speakerdeck\\.com/.*/.[^\\s]*","https?://speakerdeck\\.com/.*/.[^\\s]*","https?://ted\\.com/talks/.[^\\s]*","https?://www\\.nytimes\\.com/svc/oembed","https?://nytimes\\.com/.[^\\s]*","https?://.*\\.nytimes\\.com/.[^\\s]*","https?://clips\\.twitch\\.tv/.[^\\s]*","https?://clips\\.twitch\\.tv/.[^\\s]*","https?://www\\.twitch\\.tv/.[^\\s]*","https?://www\\.twitch\\.tv/.[^\\s]*","https?://twitch\\.tv/.[^\\s]*","https?://twitch\\.tv/.[^\\s]*","https?://.*\\.ustream\\.tv/.[^\\s]*","https?://.*\\.ustream\\.com/.[^\\s]*","https?://veervr\\.tv/videos/.[^\\s]*","https?://www\\.vevo\\.com/.[^\\s]*","https?://www\\.vevo\\.com/.[^\\s]*","https?://player\\.vimeo\\.com/video/.[^\\s]*","https?://vine\\.co/v/.[^\\s]*","https?://vine\\.co/v/.[^\\s]*"],name:"oEmbed"},{name:"Imgur",patterns:["https?://imgur\\.com/(?:[^\\/]+/)?[0-9a-zA-Z]+$"]},{patterns:["https?://www\\.(dropbox\\.com/s/.+\\.(?:jpg|png|gif))","https?://db\\.tt/[a-zA-Z0-9][^\\s]+"],name:"Dropbox"},{patterns:["https?:\\/\\/(?:[^\\.]+\\.)?youtube\\.com\\/watch\\/?\\?(?:.+&)?v=([^&][^\\s]+)","https?://(?:[^\\.]+\\.)?(?:youtu\\.be|youtube\\.com/embed)/([a-zA-Z0-9_-][^\\s]+)"],name:"YouTube"},{patterns:["https?://(?:www|mobile\\.)?twitter\\.com/(?:#!/)?([^/]+)/status(?:es)?/(\\d+)"],name:"Twitter"}],Y="noEmbed";m.id=Y;var F=/&/g,V=/</g,$=/>/g,q=/\'/g,H=/\"/g,G=/[&<>\"\']/,J=function(t){return t=function(t){return String(null===t||void 0===t?"":t)}(t),G.test(t)?t.replace(F,"&amp;").replace(V,"&lt;").replace($,"&gt;").replace(q,"&#39;").replace(H,"&quot;"):t},Q=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,W=/\b(([a-zA-Z0-9\-\_\.])+(\+[a-zA-Z0-9]*)?@[a-zA-Z\_\-]+?(\.[a-zA-Z]{2,6})+)/gim,X=function(t,e){e||(e={});for(var n,r="",o=0,i=!1===e.escape?function(t){return t}:J;n=Q.exec(t);)r+=i(t.slice(o,n.index)),r+=d(n[0],e.attributes),o=Q.lastIndex;return r+=i(t.slice(o)),r=function(t,e){var n=v(e);return t.replace(W,function(t,e){var r=v({href:"mailto:"+e});return n&&(r+=" "+n),"<a "+r+">"+J(e)+"</a>"})}(r,e.attributes)},tt="url";w.id=tt;var et=function(){return/(?:youtube\.com\/\S*(?:(?:\/e(?:mbed))?\/|watch\/?\?(?:\S*?&?v\=))|youtu\.be\/)([a-zA-Z0-9_-]{6,11})/g},nt="youtube",rt="https://www.youtube.com/";y.id=nt;var ot="facebook";b.id=ot;var it="media",st=["gif","jpg","jpeg","tiff","png","svg","webp"],ut=["ogv","webm","mp4"],ct=["wav","mp3","ogg"];x.id=it;var at="instagram";j.id=at;return function(t){var e=A({},{exclude:[]},t);return[w,a,h,m,y,b,c,x,j].map(function(n){var r=n.id,o=e[r];return-1===e.exclude.indexOf(n.id)?n("youtube"===r||"map"===r?A({},{gAuthKey:t.gAuthKey},o):"noEmbed"===r?A({},o,{exclude:["youtube"]}):o):null}).filter(function(t){return!!t})}});
//# sourceMappingURL=embed-preset-basic.min.js.map
